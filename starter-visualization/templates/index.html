<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Telemetry Visualization</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            color: #fff;
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        #legend {
            width: 80%;
            margin: 20px 0;
            font-size: 24px;
            background-color: rgba(255, 255, 255, 0.1); /* Semi-transparent background */
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        #legend table {
            font-size: 18px;
            width: 100%;
            margin: 0 auto;
        }

        #legend table tr td {
            padding-right: 15px;
            text-align: left;
        }

        .chart-container {
            width: 80%;
            height: 40vh; /* Increased chart height */
            margin-bottom: 20px;
        }

        #telemetryChart, #driftChart {
            width: 100%;
            height: 100%;
        }

        #unicornGif {
            position: absolute;
            bottom: 10px;
            width: 100px;
            height: auto;
        }
    </style>
</head>
<body>
    <div id="legend">
        <table id="telemetryTable">
            <!-- Dynamic rows will be added here -->
        </table>
    </div>
    <div class="chart-container">
        <canvas id="telemetryChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="driftChart"></canvas>
    </div>
    <img id="unicornGif" src="https://media1.tenor.com/m/oZaBy0apQPoAAAAd/rainbow-unicorn.gif" alt="Unicorn GIF">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const telemetryTable = document.getElementById('telemetryTable');
        const ctxTelemetry = document.getElementById('telemetryChart').getContext('2d');
        const ctxDrift = document.getElementById('driftChart').getContext('2d');

        const currentLocation = window.location;
        const socket = io.connect(`${currentLocation.protocol}//${currentLocation.host}`);

        const telemetryData = {
            datasets: [
                {
                    label: 'deep',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    data: [],
                },
                {
                    label: 'linear',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    data: [],
                },
            ],
        };

        const driftData = {
            datasets: [
                {
                    label: 'drift',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    data: [],
                },
            ],
        };

        const telemetryChart = new Chart(ctxTelemetry, {
            type: 'line',
            data: telemetryData,
            options: {
                responsive: true,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        title: {
                            display: true,
                            text: 'X',
                        },
                        ticks: {
                            autoSkip: false,
                            maxTicksLimit: 50,
                            stepSize: 1
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Accuracy (%)',
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toFixed(2) + '%';
                            }
                        }
                    },
                },
            },
        });

        const driftChart = new Chart(ctxDrift, {
            type: 'line',
            data: driftData,
            options: {
                responsive: true,
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        title: {
                            display: true,
                            text: 'X',
                        },
                        ticks: {
                            autoSkip: false,
                            maxTicksLimit: 50,
                            stepSize: 1
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Drift',
                        },
                        ticks: {
                            callback: function(value) {
                                return value.toFixed(2);
                            }
                        }
                    },
                },
            },
        });

        function updateTelemetry(telemetry) {
            telemetryTable.innerHTML = '';

            for (const [key, value] of Object.entries(telemetry)) {
                const row = document.createElement('tr');

                const keyCell = document.createElement('td');
                keyCell.textContent = `${key}:`;
                row.appendChild(keyCell);

                const valueCell = document.createElement('td');
                valueCell.textContent = parseFloat(value).toFixed(2);
                row.appendChild(valueCell);

                telemetryTable.appendChild(row);
            }

            const xValue = telemetry.x;

            if (telemetry.deep !== undefined) {
                telemetryData.datasets[0].data.push({ x: xValue, y: telemetry.deep * 100 });
            }

            if (telemetry.linear !== undefined) {
                telemetryData.datasets[1].data.push({ x: xValue, y: telemetry.linear * 100 });
            }

            if (telemetry.drift !== undefined) {
                driftData.datasets[0].data.push({ x: xValue, y: telemetry.drift });
            }

            telemetryChart.update();
            driftChart.update();
        }

        socket.on('telemetry', (telemetry) => {
            updateTelemetry(telemetry);
        });
    </script>
</body>
</html>
